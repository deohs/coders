---
title: "PDF Scraping WA Covid Data using OneDrive"
output: 
  html_document:
    keep_md: true
editor_options: 
  chunk_output_type: console
---

# Setup

Load packages and setup a data folder in OneDrive, assuming you have already configured OneDrive sync client using the defaults.

```{r}
# Load packages
if (!require(pacman)) install.packages("pacman")
pacman::p_load(readr, dplyr, tabulizer)

# Prepare data folder
data_dir <- file.path(Sys.getenv("HOME"), "..", "OneDrive", "coders", "data")
if (!dir.exists(data_dir)) {
  dir.create(data_dir, showWarnings = FALSE, recursive = TRUE)
}
```

# Get PDf File

See: https://www.doh.wa.gov/Emergencies/COVID19/DataDashboard#downloads

```{r}
# Download file
filename <- "Weekly-COVID-19-Long-Term-Care-Report.pdf"
filepath <- file.path(data_dir, filename)
if (!file.exists(filepath)) {
  url <- paste0('https://www.doh.wa.gov/Portals/1/Documents/1600/coronavirus/',
                'data-tables/', filename)
  download.file(url, filepath)
}
```

# Extract Data from PDf File

```{r}
txt <- extract_text(file = filepath)
lines <- c('county;deaths;cases', read_lines(txt) %>% .[c(71:94, 100:111)])
lines <- gsub('\\s+(\\d)', ';\\1', lines) %>% gsub(',', '', .)
df <- read_delim(lines, delim = ';', trim_ws = TRUE)
```

# View Data

```{r}
knitr::kable(df)
```
